!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){"use strict";
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * Copyright(c) 2016 Jeff Kohrman
 * MIT Licensed
 */e.parse=function(t,e){if("string"!=typeof t)throw new TypeError("argument str must be a string");for(var r={},i=e||{},o=t.split(a),c=i.decode||n,h=0;h<o.length;h++){var u,l,p=o[h],f=p.indexOf("=");f<0?(u=p.trim(),l="true"):(u=p.substr(0,f).trim(),l=p.substr(++f,p.length).trim()),'"'==l[0]&&(l=l.slice(1,-1)),null==r[u]&&(r[u]=s(l,c))}return r},e.serialize=function(t,e,r){var n=r||{},a=n.encode||i;if("function"!=typeof a)throw new TypeError("option encode is invalid");if(!o.test(t))throw new TypeError("argument name is invalid");var s=a(e);if(s&&!o.test(s))throw new TypeError("argument val is invalid");var c=t+"="+s;if(null!=n.maxAge){var h=n.maxAge-0;if(isNaN(h))throw new Error("maxAge should be a Number");c+="; Max-Age="+Math.floor(h)}if(n.domain){if(!o.test(n.domain))throw new TypeError("option domain is invalid");c+="; Domain="+n.domain}if(n.path){if(!o.test(n.path))throw new TypeError("option path is invalid");c+="; Path="+n.path}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw new TypeError("option expires is invalid");c+="; Expires="+n.expires.toUTCString()}n.httpOnly&&(c+="; HttpOnly");n.secure&&(c+="; Secure");if(n.sameSite){switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"strict":c+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return c};var n=decodeURIComponent,i=encodeURIComponent,a=/; */,o=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function s(t,e){try{return e(t)}catch(e){return t}}},function(t,e,r){"use strict";r.r(e);var n=class{constructor(){this.config={keys:{abTestCookie:"experimental"},apiEndpoints:{favicon:"https://dash.cloudflare.com/favicon.ico",variantList:"https://cfw-takehome.developers.workers.dev/api/variants",variants:[]}}}setVariantEnpoints(t){this.config.apiEndpoints.variants=t}getFaviconEndpoint(){return this.config.apiEndpoints.favicon}getVariantListEndpoint(){return this.config.apiEndpoints.variantList}getVariantEndpoint(t){const e=t<this.config.apiEndpoints.variants.length?t:0;return this.config.apiEndpoints.variants.length>0?this.config.apiEndpoints.variants[e]:null}getAbTestCookieKey(){return this.config.keys.abTestCookie}};const i=(a="get",t=>t.method.toLowerCase()===a.toLowerCase());var a;var o=class{constructor(){this.routes=[]}handle(t,e){return this.routes.push({conditions:t,handler:e}),this}get(t,e){return this.handle([i,(r=t,t=>{const e=new URL(t.url).pathname;return(e.match(r)||[])[0]===e})],e);var r}route(t){const e=this.resolve(t);return e?e.handler(t):new Response("resource not found",{status:404,statusText:"not found",headers:{"content-type":"text/plain"}})}resolve(t){return this.routes.find(e=>!(e.conditions&&(!Array.isArray(e)||e.conditions.length))||("function"==typeof e.conditions?e.conditions(t):e.conditions.every(e=>e(t))))}},s=r(0),c=r.n(s);var h=class{constructor(t){const e=t.get("cookie");this.cookies=e?c.a.parse(e):{}}get(t){return Object.prototype.hasOwnProperty.call(this.cookies,t)?this.cookies[t]:null}};var u=class{constructor(t){this.spec=this.generateSpecs(t)}generateSpecs(t){const e={};for(let r=0;r<t;r+=1)e[r]=1/parseFloat(t);return e}getWeightedRandom(){const t=Math.random();let e=0,r=null;for(const[n,i]of Object.entries(this.spec))if(e+=i,r=n,t<=e)return n;return r}getVariant(){return this.getWeightedRandom()}};var l=class{constructor(t=null,e=null){if(this.attributeName=t,e){const{searchText:t,replaceWith:r}=e;this.searchText=t,this.replaceWith=r}else this.searchText=null,this.replaceWith=null}element(t){if(this.attributeName){const e=t.getAttribute(this.attributeName);e?t.setAttribute(this.attributeName,e.replace(this.searchText,this.replaceWith)):t.setAttribute(this.attributeName,this.replaceWith)}}text(t){this.searchText&&this.replaceWith&&t.text.match(this.searchText)&&t.replace(this.replaceWith)}};var p=t=>(new HTMLRewriter).on("title",new l(null,{searchText:/(variant \d+(\.\d)*)/i,replaceWith:"Octapipers"})).on("h1#title",new l(null,{searchText:/(variant \d+(\.\d)*)/i,replaceWith:"Octapipers"})).on("p#description",new l(null,{searchText:/(?<=This is variant)(.*)(?=of the take home project!)/g,replaceWith:"Not all those who wander are lost. - J.R.R. Tolkein"})).on("a#url",new l("href",{searchText:"cloudflare.com",replaceWith:"prabhanshu.com"})).on("a#url",new l("target",{searchText:"",replaceWith:"_blank"})).on("a#url",new l(null,{searchText:"Return to cloudflare.com",replaceWith:"Visit my home on web"})).transform(t);var f=class{constructor(t){this.config=t,this.abTest=null}async updateVariantList(){const t=this.config.getVariantListEndpoint(),e=await fetch(t),r=await e.json();r&&r.variants&&(this.config.setVariantEnpoints(r.variants),this.abTest=new u(r.variants.length))}getVariantFromCookie(t){return new h(t).get(this.config.getAbTestCookieKey())}selectVariant(t){const e=this.getVariantFromCookie(t)||this.abTest.getVariant();return[e,this.config.getVariantEndpoint(e)]}async serveVariant(t){try{const[e,r]=this.selectVariant(t.headers),n=await fetch(r),i=p(n);return i.headers.append("Set-Cookie",`${this.config.getAbTestCookieKey()}=${e}; path=/`),i}catch(t){return new Response("Internal Server Error",{status:500,headers:{"Content-Type":"text/html"}})}}async handleRequest(t){return await this.updateVariantList(),await this.serveVariant(t)}};const d=new n,g=new f(d);addEventListener("fetch",t=>{t.respondWith(async function(t){const e=new o;return e.get(".*/favicon.ico",()=>fetch(d.getFaviconEndpoint())),e.get("/",t=>g.handleRequest(t)),await e.route(t)}(t.request))})}]);