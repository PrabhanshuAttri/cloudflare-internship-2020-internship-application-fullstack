!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();t.exports=e=r.fetch,e.default=r.fetch.bind(r),e.Headers=r.Headers,e.Request=r.Request,e.Response=r.Response},function(t,e,n){"use strict";
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * Copyright(c) 2016 Jeff Kohrman
 * MIT Licensed
 */e.parse=function(t,e){if("string"!=typeof t)throw new TypeError("argument str must be a string");for(var n={},i=e||{},o=t.split(a),c=i.decode||r,u=0;u<o.length;u++){var l,h,p=o[u],f=p.indexOf("=");f<0?(l=p.trim(),h="true"):(l=p.substr(0,f).trim(),h=p.substr(++f,p.length).trim()),'"'==h[0]&&(h=h.slice(1,-1)),null==n[l]&&(n[l]=s(h,c))}return n},e.serialize=function(t,e,n){var r=n||{},a=r.encode||i;if("function"!=typeof a)throw new TypeError("option encode is invalid");if(!o.test(t))throw new TypeError("argument name is invalid");var s=a(e);if(s&&!o.test(s))throw new TypeError("argument val is invalid");var c=t+"="+s;if(null!=r.maxAge){var u=r.maxAge-0;if(isNaN(u))throw new Error("maxAge should be a Number");c+="; Max-Age="+Math.floor(u)}if(r.domain){if(!o.test(r.domain))throw new TypeError("option domain is invalid");c+="; Domain="+r.domain}if(r.path){if(!o.test(r.path))throw new TypeError("option path is invalid");c+="; Path="+r.path}if(r.expires){if("function"!=typeof r.expires.toUTCString)throw new TypeError("option expires is invalid");c+="; Expires="+r.expires.toUTCString()}r.httpOnly&&(c+="; HttpOnly");r.secure&&(c+="; Secure");if(r.sameSite){switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"strict":c+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return c};var r=decodeURIComponent,i=encodeURIComponent,a=/; */,o=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function s(t,e){try{return e(t)}catch(e){return t}}},function(t,e,n){"use strict";n.r(e);var r=n(0),i=n.n(r);var a=class{constructor(){this.config={keys:{abTestCookie:"experimental"},apiEndpoints:{favicon:"https://www.prabhanshu.com/img/favicons/favicon-96x96.png",variantList:"https://cfw-takehome.developers.workers.dev/api/variants",variants:[]}}}setVariantEnpoints(t){this.config.apiEndpoints.variants=t}getFaviconEndpoint(){return this.config.apiEndpoints.favicon}getVariantListEndpoint(){return this.config.apiEndpoints.variantList}getVariantEndpoint(t){const e=t<this.config.apiEndpoints.variants.length?t:0;return this.config.apiEndpoints.variants.length>0?this.config.apiEndpoints.variants[e]:null}getVariantCount(){return this.config.apiEndpoints.variants.length}getAbTestCookieKey(){return this.config.keys.abTestCookie}};const o=(s="get",t=>t.method.toLowerCase()===s.toLowerCase());var s;var c=class{constructor(){this.routes=[]}handle(t,e){return this.routes.push({conditions:t,handler:e}),this}get(t,e){return this.handle([o,(n=t,t=>{const e=new URL(t.url).pathname;return(e.match(n)||[])[0]===e})],e);var n}route(t){const e=this.resolve(t);return e?e.handler(t):new Response("resource not found",{status:404,statusText:"not found",headers:{"content-type":"text/plain"}})}resolve(t){return this.routes.find(e=>!(e.conditions&&(!Array.isArray(e)||e.conditions.length))||("function"==typeof e.conditions?e.conditions(t):e.conditions.every(e=>e(t))))}},u=n(1),l=n.n(u);var h=class{constructor(t){const e=t.get("cookie");this.cookies=e?l.a.parse(e):{}}get(t){return Object.prototype.hasOwnProperty.call(this.cookies,t)?this.cookies[t]:null}};var p=class{constructor(t){this.spec=this.generateSpecs(t)}generateSpecs(t){const e={};for(let n=0;n<t;n+=1)e[n]=1/parseFloat(t);return e}getVariant(){const t=Math.random();let e=0,n=null;for(const[r,i]of Object.entries(this.spec))if(e+=i,n=r,t<=e)return r;return n}};var f=class{constructor(t=null,e=null){if(this.attributeName=t,e){const{searchText:t,replaceWith:n}=e;this.searchText=t,this.replaceWith=n}else this.searchText=null,this.replaceWith=null}element(t){if(this.attributeName){const e=t.getAttribute(this.attributeName);e?t.setAttribute(this.attributeName,e.replace(this.searchText,this.replaceWith)):t.setAttribute(this.attributeName,this.replaceWith)}}text(t){this.searchText&&this.replaceWith&&t.text.match(this.searchText)&&t.replace(this.replaceWith)}};var d=t=>(new HTMLRewriter).on("title",new f(null,{searchText:/(variant \d+(\.\d)*)/i,replaceWith:"Octapipers"})).on("h1#title",new f(null,{searchText:/(variant \d+(\.\d)*)/i,replaceWith:"Octapipers"})).on("p#description",new f(null,{searchText:/(?<=This is variant)(.*)(?=of the take home project!)/g,replaceWith:"Not all those who wander are lost. - J.R.R. Tolkein"})).on("a#url",new f("href",{searchText:"cloudflare.com",replaceWith:"prabhanshu.com"})).on("a#url",new f("target",{searchText:"",replaceWith:"_blank"})).on("a#url",new f(null,{searchText:"Return to cloudflare.com",replaceWith:"Visit my home on web"})).transform(t);var g=class{constructor(t){this.config=t,this.abTest=null}async getErrorResponse(t,e=null){let n="";if(e)n=e;else switch(t){case 500:n="Internal Server Error";break;case 503:n="Service Unavailable";break;case 404:default:n="Not found"}return new Response(n,{status:t,headers:{"Content-Type":"text/html"}})}async updateVariantList(){const t=this.config.getVariantListEndpoint();try{const e=await i()(t);if(200!==e.status)throw"Status not 200";const n=await e.json();if(!n||!n.variants)throw"Variants not found";this.config.setVariantEnpoints(n.variants),this.abTest=new p(n.variants.length)}catch(t){}}getVariantFromCookie(t){return new h(t).get(this.config.getAbTestCookieKey())}selectVariant(t){const e=this.getVariantFromCookie(t)||this.abTest.getVariant();return[e,this.config.getVariantEndpoint(e)]}async serveVariant(t){try{if(this.config.getVariantCount()<1)throw"No variant available";const[e,n]=this.selectVariant(t.headers),r=await i()(n);if(200!==r.status)throw"Variant page not accessible";const a=d(r);return a.headers.append("Set-Cookie",`${this.config.getAbTestCookieKey()}=${e}; path=/`),a}catch(t){return this.getErrorResponse(404,"This page is not available")}}async handleRequest(t){return await this.updateVariantList(),await this.serveVariant(t)}};const v=new a,w=new g(v);addEventListener("fetch",t=>{t.respondWith(async function(t){const e=new c;return e.get(".*/favicon.ico",()=>i()(v.getFaviconEndpoint())),e.get("/",t=>w.handleRequest(t)),await e.route(t)}(t.request))})}]);