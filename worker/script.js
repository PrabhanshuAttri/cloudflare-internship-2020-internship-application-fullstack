!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){"use strict";
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * Copyright(c) 2016 Jeff Kohrman
 * MIT Licensed
 */e.parse=function(t,e){if("string"!=typeof t)throw new TypeError("argument str must be a string");for(var n={},i=e||{},a=t.split(o),c=i.decode||r,u=0;u<a.length;u++){var p,l,d=a[u],h=d.indexOf("=");h<0?(p=d.trim(),l="true"):(p=d.substr(0,h).trim(),l=d.substr(++h,d.length).trim()),'"'==l[0]&&(l=l.slice(1,-1)),null==n[p]&&(n[p]=s(l,c))}return n},e.serialize=function(t,e,n){var r=n||{},o=r.encode||i;if("function"!=typeof o)throw new TypeError("option encode is invalid");if(!a.test(t))throw new TypeError("argument name is invalid");var s=o(e);if(s&&!a.test(s))throw new TypeError("argument val is invalid");var c=t+"="+s;if(null!=r.maxAge){var u=r.maxAge-0;if(isNaN(u))throw new Error("maxAge should be a Number");c+="; Max-Age="+Math.floor(u)}if(r.domain){if(!a.test(r.domain))throw new TypeError("option domain is invalid");c+="; Domain="+r.domain}if(r.path){if(!a.test(r.path))throw new TypeError("option path is invalid");c+="; Path="+r.path}if(r.expires){if("function"!=typeof r.expires.toUTCString)throw new TypeError("option expires is invalid");c+="; Expires="+r.expires.toUTCString()}r.httpOnly&&(c+="; HttpOnly");r.secure&&(c+="; Secure");if(r.sameSite){switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"strict":c+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return c};var r=decodeURIComponent,i=encodeURIComponent,o=/; */,a=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function s(t,e){try{return e(t)}catch(e){return t}}},function(t,e,n){"use strict";n.r(e);const r=(i="get",t=>t.method.toLowerCase()===i.toLowerCase());var i;var o=class{constructor(){this.routes=[]}handle(t,e){return this.routes.push({conditions:t,handler:e}),this}get(t,e){return this.handle([r,(n=t,t=>{const e=new URL(t.url).pathname;return(e.match(n)||[])[0]===e})],e);var n}route(t){const e=this.resolve(t);return e?e.handler(t):new Response("resource not found",{status:404,statusText:"not found",headers:{"content-type":"text/plain"}})}resolve(t){return this.routes.find(e=>!(e.conditions&&(!Array.isArray(e)||e.conditions.length))||("function"==typeof e.conditions?e.conditions(t):e.conditions.every(e=>e(t))))}},a=n(0),s=n.n(a);var c=class{constructor(t){const e=t.get("cookie");this.cookies=e?s.a.parse(e):{}}get(t){return this.cookies.hasOwnProperty(t)?this.cookies[t]:null}};var u=class{constructor(t){this.spec=this.generateSpecs(t)}generateSpecs(t){const e={};for(let n=0;n<t;n++)e[n]=1/parseFloat(t);return e}getWeightedRandom(){const t=Math.random();let e=0;for(let[n,r]of Object.entries(this.spec))if(e+=r,t<=e)return n}getVariant(){return this.getWeightedRandom()}};var p=class{constructor(){this.config={keys:{abTestCookie:"experimental"},apiEndpoints:{favicon:"https://dash.cloudflare.com/favicon.ico",variantList:"https://cfw-takehome.developers.workers.dev/api/variants",variants:[]}}}setVariantEnpoints(t){this.config.apiEndpoints.variants=t}getFaviconEndpoint(){return this.config.apiEndpoints.favicon}getVariantListEndpoint(){return this.config.apiEndpoints.variantList}getVariantEndpoint(t){let e=t<this.config.apiEndpoints.variants.length?t:0;return this.config.apiEndpoints.variants.length>0?this.config.apiEndpoints.variants[e]:null}getAbTestCookieKey(){return this.config.keys.abTestCookie}};const l=new p;var d=class{constructor(){this.abTest=null}async updateVariantList(){const t=l.getVariantListEndpoint(),e=await fetch(t),n=await e.json();n&&n.variants&&(l.setVariantEnpoints(n.variants),this.abTest=new u(n.variants.length))}getVariantFromCookie(t){return new c(t).get(l.getAbTestCookieKey())}selectVariant(t){let e=this.getVariantFromCookie(t)||this.abTest.getVariant();return[e,l.getVariantEndpoint(e)]}async serveVariant(t){try{const[e,n]=this.selectVariant(t.headers),r=await fetch(n),i=await r.text(),o=new Response(i,{headers:{"Content-Type":r.headers.get("content-type")},status:r.status});return o.headers.append("Set-Cookie",`${l.getAbTestCookieKey()}=${e}; path=/`),o}catch(t){return console.log("eee",t),new Response("Internal Server Error",{status:500,headers:{"Content-Type":"text/html"}})}}async handleRequest(t){return await this.updateVariantList(),await this.serveVariant(t)}};const h=new p,f=new d;addEventListener("fetch",t=>{t.respondWith(async function(t,e){const n=new o;return n.get(".*/favicon.ico",t=>fetch(h.getFaviconEndpoint())),n.get("/",t=>f.handleRequest(t)),await n.route(t)}(t.request))})}]);